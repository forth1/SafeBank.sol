<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Event Listener Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
</head>
<body style="background:#111; color:#fff; font-family:Arial; padding:20px;">

<h2>Event Listener Demo</h2>

<button id="connect">è¿æ¥é’±åŒ…</button>

<p>å½“å‰è´¦å·ï¼š<span id="addr">æœªè¿æ¥</span></p >

<hr>

<script>
const CONTRACT_ADDRESS = "0xCFFE24918BB30638D135C326c78Ab217A59d565c";

const ABI = [
    {
        "inputs": [],
        "name": "deposit",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [
            {"indexed": true, "internalType": "address", "name": "user", "type": "address"},
            {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
        ],
        "name": "Deposit",
        "type": "event"
    },
    {
        "inputs": [{"internalType": "uint256", "name": "amount", "type": "uint256"}],
        "name": "withdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [
            {"indexed": true, "internalType": "address", "name": "user", "type": "address"},
            {"indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256"}
        ],
        "name": "Withdraw",
        "type": "event"
    },
    {
        "inputs":[{"internalType":"address","name":"","type":"address"}],
        "name":"balances",
        "outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
        "stateMutability":"view",
        "type":"function"
    }
];

let provider, signer, contract;

document.getElementById("connect").onclick = async () => {
    provider = new ethers.BrowserProvider(window.ethereum);
    signer = await provider.getSigner();
    const addr = await signer.getAddress();
    document.getElementById("addr").textContent = addr;

    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

    alert("é’±åŒ…å·²è¿æ¥ï¼Œäº‹ä»¶ç›‘å¬å·²å¯åŠ¨ï¼");

    // ------- ç›‘å¬å­˜æ¬¾äº‹ä»¶ -------
    contract.on("Deposit", (user, amount) => {
        console.log("ğŸ“¥ Deposit äº‹ä»¶è§¦å‘");
        console.log("ç”¨æˆ·ï¼š", user);
        console.log("é‡‘é¢ï¼š", amount.toString());
        alert(`ğŸ’° å­˜æ¬¾äº‹ä»¶ï¼š${user} å­˜å…¥ ${amount.toString()} wei`);
    });

    // ------- ç›‘å¬å–æ¬¾äº‹ä»¶ -------
    contract.on("Withdraw", (user, amount) => {
        console.log("ğŸ“¤ Withdraw äº‹ä»¶è§¦å‘");
        console.log("ç”¨æˆ·ï¼š", user);
        console.log("é‡‘é¢ï¼š", amount.toString());
        alert(`ğŸ§ å–æ¬¾äº‹ä»¶ï¼š${user} å–å‡º ${amount.toString()} wei`);
    });
};
</script>

</body>
</html>
