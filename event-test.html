<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Event Listener Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
</head>
<body style="background:#111; color:#fff; font-family:Arial; padding:20px;">

<h2>Event Listener Demo</h2>

<button id="connect">è¿æ¥é’±åŒ…</button>

<p>å½“å‰è´¦å·ï¼š<span id="addr">æœªè¿æ¥</span></p >

<hr>

<script>
const CONTRACT_ADDRESS = "ã€ä½ çš„ EventDemo åˆçº¦åœ°å€æ”¾è¿™é‡Œã€‘";

const ABI = [
  "event MessageChanged(address indexed user, string oldMsg, string newMsg)",
  "function setMessage(string _msg) external",
  "function message() view returns (string)"
];

let provider, signer, contract;

document.getElementById("connect").onclick = async () => {
  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  const addr = await signer.getAddress();
  document.getElementById("addr").textContent = addr;

  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  // ç›‘å¬äº‹ä»¶ï¼ˆé‡ç‚¹ï¼‰
  contract.on("MessageChanged", (user, oldMsg, newMsg) => {
    console.log("ğŸ“¢ äº‹ä»¶è§¦å‘ï¼");
    console.log("ç”¨æˆ·ï¼š", user);
    console.log("æ—§æ¶ˆæ¯ï¼š", oldMsg);
    console.log("æ–°æ¶ˆæ¯ï¼š", newMsg);
    alert(`äº‹ä»¶è§¦å‘ï¼š${newMsg}`);
  });

  alert("å·²è¿æ¥å¹¶å¼€å§‹ç›‘å¬äº‹ä»¶ï¼");
}
</script>

</body>
</html>
